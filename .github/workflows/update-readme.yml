name: Auto Commit & Update README

on:
  push:
    branches:
      - main
    # EmpÃªche le workflow de se relancer quand lui-mÃªme modifie ces fichiers
    paths-ignore:
      - 'LAST_UPDATED'
      - 'README.md'
  schedule:
    - cron: "0 0 * * *"  # Tous les jours Ã  minuit UTC
  workflow_dispatch:

permissions:
  contents: write

jobs:
  auto_commit:
    runs-on: ubuntu-latest

    steps:
      # 1ï¸âƒ£ RÃ©cupÃ©rer le repo
      - uses: actions/checkout@v3
        with:
          persist-credentials: false
          fetch-depth: 0

      # 2ï¸âƒ£ Modifier la date dans LAST_UPDATED
      - name: Update LAST_UPDATED
        run: echo "`date '+%d/%m/%Y %H:%M:%S'`" > LAST_UPDATED

      # 3ï¸âƒ£ Modifier la date dans README.md
      - name: Update README date
        run: |
          DATE=$(date +"%d/%m/%Y")
          sed -i "/<!--DATE-PLACEHOLDER-->/!b;n;c<p align=\"right\">$DATE</p>" README.md

      # 4ï¸âƒ£ Commit avec message alÃ©atoire
      - name: Commit changes
        run: |
          git config --local user.email "lorick.tsarazaka.lk@gmail.com"
          git config --local user.name "lorick-tsarazaka"
          git add -A

          array[0]="ğŸŒŸ Auto commit [auto]"
          array[1]="âš¡ Auto commit [auto]"
          array[2]="ğŸŒˆ Auto commit [auto]"
          array[3]="ğŸª² Auto commit [auto]"
          array[4]="ğŸ“– Auto commit [auto]"
          array[5]="ğŸ› ï¸ Auto commit [auto]"
          array[6]="ğŸƒ Auto commit [auto]"
          array[7]="ğŸ’¥ Auto commit [auto]"
          array[8]="ğŸš¨ Auto commit [auto]"
          array[9]="ğŸ” Auto commit [auto]"

          git commit -m "${array[$RANDOM % ${#array[@]}]}" || echo "No changes to commit"

      # 5ï¸âƒ£ Pousser avec PAT
      - name: Push changes
        run: |
          git config --local user.email "lorick.tsarazaka.lk@gmail.com"
          git config --local user.name "lorick-tsarazaka"

          git remote set-url origin https://lorick-tsarazaka:${{ secrets.PAT_TOKEN }}@github.com/lorick-tsarazaka/lorick-tsarazaka.git

          git push origin main
