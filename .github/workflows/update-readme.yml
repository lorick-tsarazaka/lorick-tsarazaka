name: Auto Commit & Update README

on:
  push:
    branches:
      - main
  schedule:
    - cron: "0 0 * * *"  # Tous les jours Ã  minuit UTC
  workflow_dispatch:

permissions:
  contents: write

jobs:
  auto_commit:
    runs-on: ubuntu-latest

    steps:
      # 1ï¸âƒ£ RÃ©cupÃ©rer le repo
      - uses: actions/checkout@v3
        with:
          persist-credentials: false
          fetch-depth: 0

      # 2ï¸âƒ£ Modifier la date dans LAST_UPDATED
      - name: Update LAST_UPDATED
        run: echo `date '+%d/%m/%Y %H:%M:%S'` > LAST_UPDATED

      # 3ï¸âƒ£ Modifier la date dans README.md
      - name: Update README date
        run: |
          DATE=$(date +"%d/%m/%Y")
          sed -i "/<!--DATE-PLACEHOLDER-->/!b;n;c<p align=\"right\">$DATE</p>" README.md

      # 4ï¸âƒ£ Commit avec message alÃ©atoire
      - name: Commit changes
        run: |
          git config --local user.email "kevinramarozatovo@gmail.com"
          git config --local user.name "Kevin-rm"
          git add -A

          array[0]="ğŸŒŸ Auto commit"
          array[1]="âš¡ Auto commit"
          array[2]="ğŸŒˆ Auto commit"
          array[3]="ğŸª² Auto commit"
          array[4]="ğŸ“– Auto commit"
          array[5]="ğŸ› ï¸ Auto commit"
          array[6]="ğŸƒ Auto commit"
          array[7]="ğŸ’¥ Auto commit"
          array[8]="ğŸš¨ Auto commit"
          array[9]="ğŸ” Auto commit"

          git commit -m "${array[$RANDOM % ${#array[@]}]}" || echo "No changes to commit"

      # 5ï¸âƒ£ Push
      - name: Push changes
        uses: ad-m/github-push-action@v0.6.0
        with:
          directory: "."
          branch: "main"
          github_token: ${{ secrets.GITHUB_TOKEN }}
